# BookTools

ãŠå“æ›¸ã

- book_sort.py : å®šè·¡DBã®sort(SFENæ–‡å­—åˆ—ã§ä¸¦ã³æ›¿ãˆ)ã‚’è¡Œã†ã€‚
- book_merge.py : è¤‡æ•°ã®å®šè·¡DBã®merge(çµåˆ)ã‚’è¡Œã†
- book_add_ply.py : gamePly(åˆæœŸå±€é¢ã‹ã‚‰ã®æ‰‹æ•°)ãŒä»˜ä¸Žã•ã‚Œã¦ã„ãªã„å®šè·¡DBã«å¯¾ã—ã¦æ‰‹æ•°ã‚’ä»˜ä¸Žã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

## book_sort.py

- [book_sort.py](../book_sort.py) : å®šè·¡DBã®sortã‚’è¡Œã†ã€‚

å·¨å¤§å®šè·¡ãƒ•ã‚¡ã‚¤ãƒ«ã¯å®Ÿè¡Œæ™‚ã«ãƒ¡ãƒ¢ãƒªã«ä¸¸èª­ã¿ã™ã‚‹ã«ã¯å¤§ãã™ãŽã‚‹ã®ã§ã€ã‚„ã­ã†ã‚‰çŽ‹ã®ã‚¨ãƒ³ã‚¸ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®BookOnTheFlyã¨è¨€ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚ªãƒ³ã«ã—ã¦åˆ©ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã‚’ã‚ªãƒ³ã«ã™ã‚‹ã¨ã€äºŒåˆ†æŽ¢ç´¢ã§å®šè·¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª¿ã¹ã‚‹ã®ã§ã™ãŒã€äºŒåˆ†æŽ¢ç´¢ã™ã‚‹ãŸã‚ã«ã¯å®šè·¡ã®å±€é¢æ–‡å­—åˆ—(SFENæ–‡å­—åˆ—)ã§è¾žæ›¸é †ã«ä¸¦ã³æ›¿ãˆãŒè¡Œã‚ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ä¸¦ã³æ›¿ãˆã‚’è¡Œã†ã®ãŒã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§ãƒ¡ãƒ¢ãƒªã«ä¸¸èª­ã¿ã¯ã§ãã¾ã›ã‚“ã®ã§ã€ãƒ¡ãƒ¢ãƒªã«ä¸¸èª­ã¿ã›ãšã«ã“ã®ä¸¦ã³æ›¿ãˆã‚’å®Ÿç¾ã—ã¾ã™ã€‚

ðŸ’¡ LMDBã¨è¨€ã†DBã«ã„ã£ãŸã‚“æ ¼ç´ã—ã¦ã€ãã‚Œã‚’æ›¸ãå‡ºã™ã“ã¨ã«ã‚ˆã£ã¦ã€å®šè·¡DBã®sortã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚LMDBã¯ã€B+Treeã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€SFENæ–‡å­—åˆ—ã‚’keyã¨ã—ã¦æ›¸ãå‡ºã—ã¦ã€lmdbã‹ã‚‰cursor(iterator)ã‚’ã‚‚ã‚‰ã£ã¦é †ç•ªã«åˆ—æŒ™ã™ã‚‹ã ã‘ã§sortãŒå®Ÿç¾ã§ãã¾ã™ã€‚

ä½¿ã„æ–¹ã®ä¾‹

>    python book_sort.py --read_file_path book/user_book1.db -- write_file_path book/user_book1-sorted.db --map_size 1

    map_sizeã¯ã€ãƒ†ãƒ³ãƒãƒ©ãƒªã¨ã—ã¦ç”¨ã„ã‚‹LMDBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã—ã¾ã™ã€‚(å˜ä½ã¯[GB])

    èª­ã¿è¾¼ã¾ã›ã‚‹å®šè·¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®3å€ãã‚‰ã„ã®å®¹é‡ãŒã‚ã‚Œã°è‰¯ã„ã§ã—ã‚‡ã†ã€‚

## book_merge.py

- [book_merge.py](../book_merge.py) : å®šè·¡DBã®mergeã‚’è¡Œã†ã€‚

ä½¿ã„æ–¹ã¯ã€book_sort.pyã¨ã»ã¼åŒã˜ã§ã™ã€‚å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦è¤‡æ•°ã®å®šè·¡DBãŒæŒ‡å®šã§ãã¾ã™ã€‚åŒã˜å±€é¢ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€å¾Œã«æŒ‡å®šã—ãŸã‚‚ã®ãŒå„ªå…ˆã•ã‚Œã¾ã™ã€‚

ä½¿ã„æ–¹ã®ä¾‹

>    python book_sort.py --read_file_path book/user_book1.db book/user_book2.db book/user_book3.db --write_file_path book/user_book-merged.db --map_size 1

